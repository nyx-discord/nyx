"use strict";(self.webpackChunk_nyx_discord_docs=self.webpackChunk_nyx_discord_docs||[]).push([[1525],{8464:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>a,metadata:()=>d,toc:()=>h});var t=n(7458),i=n(6436),r=n(52),o=n(9262);const a={title:"\ufe0f\ud83d\udee1\ufe0f Session Interception"},l=void 0,d={id:"features/sessions/session-interception",title:"\ufe0f\ud83d\udee1\ufe0f Session Interception",description:"Session interception refers to blocking a session from being executed. In nyx, there are two ways to do this:",source:"@site/docs/features/sessions/session-interception.mdx",sourceDirName:"features/sessions",slug:"/features/sessions/session-interception",permalink:"/docs/features/sessions/session-interception",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/features/sessions/session-interception.mdx",tags:[],version:"current",frontMatter:{title:"\ufe0f\ud83d\udee1\ufe0f Session Interception"},sidebar:"nyxSidebar",previous:{title:"\ud83d\udcc1 Stage Pagination Session",permalink:"/docs/features/sessions/types/stage-pagination-session"},next:{title:"\ufe0f\ud83d\udcbc Session Manager",permalink:"/docs/features/sessions/session-manager"}},c={},h=[{value:"\ud83d\udea6 Session Middlewares",id:"-session-middlewares",level:2},{value:"\u2753 When to use a middleware?",id:"-when-to-use-a-middleware",level:3},{value:"\ud83d\udc77\u200d Middleware Creation",id:"-middleware-creation",level:3},{value:"\ud83d\udea7 Session Filters",id:"-session-filters",level:2},{value:"\u2753 When to use a filter?",id:"-when-to-use-a-filter",level:3},{value:"\ud83d\udc77\u200d Filter Creation",id:"-filter-creation",level:3}];function u(e){const s={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.p,{children:"Session interception refers to blocking a session from being executed. In nyx, there are two ways to do this:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Add a ",(0,t.jsx)(s.code,{children:"SessionMiddleware"})," to the respective ",(0,t.jsx)(s.code,{children:"SessionMiddlewareLinkedList"})," in the ",(0,t.jsx)(s.code,{children:"SessionExecutor"})," that handles\nthe session execution."]}),"\n",(0,t.jsxs)(s.li,{children:["Provide the respective ",(0,t.jsx)(s.code,{children:"SessionFilter"})," in the ",(0,t.jsx)(s.code,{children:"Session"}),"."]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Let's explore when and how to use each of these methods."}),"\n",(0,t.jsx)(s.h2,{id:"-session-middlewares",children:"\ud83d\udea6 Session Middlewares"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"SessionMiddlewares"})," are objects stored on a ",(0,t.jsx)(s.code,{children:"SessionMiddlewareLinkedList"}),", which is held and called by\nthe session executor when a session is about to be executed."]}),"\n",(0,t.jsx)(s.p,{children:"Specifically, there are two types of session middlewares:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"SessionStartMiddleware"})," - Checked when a session starts."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"SessionUpdateMiddleware"})," - Checked when a session is updated."]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Each consist of:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["A ",(0,t.jsx)(s.code,{children:"check()"})," method, which takes a session and its arguments. Returns a ",(0,t.jsx)(s.code,{children:"MiddlewareResponse"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:["A ",(0,t.jsx)(s.code,{children:"Priority"}),", that determines its priority inside the list."]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["When being checked, a middleware is passed the session that is being checked and the execution metadata. The session then\nreplies with a ",(0,t.jsx)(s.code,{children:"MiddlewareResponse"}),", which can either:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Allow the execution (",(0,t.jsx)(s.code,{children:"{ allowed: true }"}),"), with either:"]}),"\n",(0,t.jsxs)(s.li,{children:["Making the linked list check the next middleware (",(0,t.jsx)(s.code,{children:"{ allowed: true, checkNext: true }"}),")."]}),"\n",(0,t.jsxs)(s.li,{children:["Forcing the chain to end (",(0,t.jsx)(s.code,{children:"{ allowed: true, checkNext: false }"}),")."]}),"\n",(0,t.jsxs)(s.li,{children:["Deny the execution (",(0,t.jsx)(s.code,{children:"{ allowed: false, checkNext: false }"}),")."]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"AbstractMiddleware"}),", has ",(0,t.jsx)(s.code,{children:"protected"})," utility methods to generate these responses. Specifically, ",(0,t.jsx)(s.code,{children:"this.true()"}),",\n",(0,t.jsx)(s.code,{children:"this.false()"})," and ",(0,t.jsx)(s.code,{children:"this.forceTrue()"}),"."]}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsx)(s.p,{children:"Middlewares are not bot aware, meaning that you can reuse the same instance for many bots."})}),"\n",(0,t.jsx)(s.h3,{id:"-when-to-use-a-middleware",children:"\u2753 When to use a middleware?"}),"\n",(0,t.jsxs)(s.p,{children:["Middlewares are best for executing something or intercepting for all sessions. For example, the filtering\n(",(0,t.jsx)(s.code,{children:"SessionFilter"}),") logic is done by a middleware."]}),"\n",(0,t.jsxs)(s.p,{children:["They're very good when intercepting ",(0,t.jsx)(s.code,{children:"Sessions"})," in general, but not really for one in particular, since it\nwould be very inefficient to check all the sessions searching for only one of them."]}),"\n",(0,t.jsx)(s.h3,{id:"-middleware-creation",children:"\ud83d\udc77\u200d Middleware Creation"}),"\n",(0,t.jsx)(s.p,{children:"You can create your own middleware by either:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Extending the respective ",(0,t.jsx)(s.code,{children:"AbstractSessionMiddleware"})," from ",(0,t.jsx)(s.code,{children:"@framework"})," (recommended)."]}),"\n",(0,t.jsxs)(s.li,{children:["Implementing the respective ",(0,t.jsx)(s.code,{children:"SessionMiddleware"})," interface from ",(0,t.jsx)(s.code,{children:"@core"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(r.Z,{children:[(0,t.jsx)(o.Z,{value:"Extending an AbstractSessionMiddleware",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import {\n  AbstractSessionStartMiddleware,\n  AbstractSessionUpdateMiddleware,\n} from '@nyx-discord/framework';\n\nclass MySessionStartMiddleware extends AbstractSessionStartMiddleware {\n  public check(session: Session, args: SessionStartArgs): MiddlewareResponse {\n    return this.true();\n  }\n}\n\nconst startMiddleware = new MySessionStartMiddleware();\nbot.sessions.getExecutor().getStartMiddleware().add(startMiddleware);\n\nclass MySessionUpdateMiddleware extends AbstractSessionUpdateMiddleware {\n  public check(session: Session, args: SessionUpdateArgs): MiddlewareResponse {\n    return this.true();\n  }\n}\n\nconst updateMiddleware = new MySessionUpdateMiddleware();\nbot.sessions.getExecutor().getUpdateMiddleware().add(updateMiddleware);\n"})})}),(0,t.jsx)(o.Z,{value:"Implementing SessionMiddleware",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import { SessionStartMiddleware, SessionUpdateMiddleware } from '@nyx-discord/core';\n\nclass MySessionStartMiddleware implements SessionStartMiddleware {\n  // ...\n}\n\nconst startMiddleware = new MySessionStartMiddleware();\nbot.sessions.getExecutor().getStartMiddleware().add(startMiddleware);\n\nclass MySessionUpdateMiddleware implements SessionUpdateMiddleware {\n  // ...\n}\n\nconst updateMiddleware = new MySessionUpdateMiddleware();\nbot.sessions.getExecutor().getUpdateMiddleware().add(updateMiddleware);\n"})})})]}),"\n",(0,t.jsx)(s.p,{children:"By default, the following middleware chain is used:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"SessionFilterCheckMiddleware"})," - See ",(0,t.jsx)(s.a,{href:"#-Session-filters",children:"\ud83d\udea7 Session Filters"}),"."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"-session-filters",children:"\ud83d\udea7 Session Filters"}),"\n",(0,t.jsxs)(s.p,{children:["An ",(0,t.jsx)(s.code,{children:"SessionFilter"})," is a nullable object provided by an ",(0,t.jsx)(s.code,{children:"Session"}),", checked by a ",(0,t.jsx)(s.code,{children:"SessionFilterCheckMiddleware"}),"."]}),"\n",(0,t.jsx)(s.p,{children:"Specifically, there are two types of session filters:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"SessionStartFilter"})," - Checked when the session starts."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"SessionUpdateFilter"})," - Checked when the session is updated."]}),"\n"]}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsx)(s.p,{children:"Filters are not bot aware nor session aware, meaning that you can reuse the same instance for many sessions."})}),"\n",(0,t.jsx)(s.admonition,{type:"tip",children:(0,t.jsxs)(s.p,{children:["Think of a filter like adding an ",(0,t.jsx)(s.code,{children:"if"})," at the beginning of your session's execution, except it gets checked before the\nsession is executed and, since it's an object, you can reuse it for multiple sessions or save state on it."]})}),"\n",(0,t.jsxs)(s.p,{children:["Though sessions can only provide one filter, ",(0,t.jsx)(s.code,{children:"@framework"})," provides utility filter aggregators that implement the\nbasic ",(0,t.jsx)(s.code,{children:"AND"}),", ",(0,t.jsx)(s.code,{children:"OR"}),", ",(0,t.jsx)(s.code,{children:"NOT"}),' gates, that can help you "combine" multiple filters into one.']}),"\n",(0,t.jsx)(s.h3,{id:"-when-to-use-a-filter",children:"\u2753 When to use a filter?"}),"\n",(0,t.jsx)(s.p,{children:"Filters are best suited for sharing common conditions that multiple sessions should share before executing."}),"\n",(0,t.jsxs)(s.p,{children:["Also, since they have access to the session that is being filtered and the ",(0,t.jsx)(s.code,{children:"SessionExecutionMeta"}),' object, filters can\nshare information to the session, effectively working as a "pre-processor".']}),"\n",(0,t.jsx)(s.h3,{id:"-filter-creation",children:"\ud83d\udc77\u200d Filter Creation"}),"\n",(0,t.jsx)(s.p,{children:"You can create your own filter by either:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Extending the respective ",(0,t.jsx)(s.code,{children:"AbstractSessionFilter"})," from ",(0,t.jsx)(s.code,{children:"@framework"})," (recommended)."]}),"\n",(0,t.jsxs)(s.li,{children:["Implementing the respective ",(0,t.jsx)(s.code,{children:"SessionFilter"})," interface from ",(0,t.jsx)(s.code,{children:"@core"}),"."]}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,i.a)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},9262:(e,s,n)=>{n.d(s,{Z:()=>o});n(2983);var t=n(8934);const i={tabItem:"tabItem_rG4d"};var r=n(7458);function o(e){let{children:s,hidden:n,className:o}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,t.Z)(i.tabItem,o),hidden:n,children:s})}},52:(e,s,n)=>{n.d(s,{Z:()=>y});var t=n(2983),i=n(8934),r=n(3743),o=n(3729),a=n(2461),l=n(8239),d=n(7333),c=n(6927);function h(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:s}=e;return!!s&&"object"==typeof s&&"value"in s}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:s,children:n}=e;return(0,t.useMemo)((()=>{const e=s??function(e){return h(e).map((e=>{let{props:{value:s,label:n,attributes:t,default:i}}=e;return{value:s,label:n,attributes:t,default:i}}))}(n);return function(e){const s=(0,d.l)(e,((e,s)=>e.value===s.value));if(s.length>0)throw new Error(`Docusaurus error: Duplicate values "${s.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[s,n])}function p(e){let{value:s,tabValues:n}=e;return n.some((e=>e.value===s))}function x(e){let{queryString:s=!1,groupId:n}=e;const i=(0,o.k6)(),r=function(e){let{queryString:s=!1,groupId:n}=e;if("string"==typeof s)return s;if(!1===s)return null;if(!0===s&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:s,groupId:n});return[(0,l._X)(r),(0,t.useCallback)((e=>{if(!r)return;const s=new URLSearchParams(i.location.search);s.set(r,e),i.replace({...i.location,search:s.toString()})}),[r,i])]}function f(e){const{defaultValue:s,queryString:n=!1,groupId:i}=e,r=u(e),[o,l]=(0,t.useState)((()=>function(e){let{defaultValue:s,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(s){if(!p({value:s,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${s}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return s}const t=n.find((e=>e.default))??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:s,tabValues:r}))),[d,h]=x({queryString:n,groupId:i}),[f,m]=function(e){let{groupId:s}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(s),[i,r]=(0,c.Nk)(n);return[i,(0,t.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:i}),w=(()=>{const e=d??f;return p({value:e,tabValues:r})?e:null})();(0,a.Z)((()=>{w&&l(w)}),[w]);return{selectedValue:o,selectValue:(0,t.useCallback)((e=>{if(!p({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);l(e),h(e),m(e)}),[h,m,r]),tabValues:r}}var m=n(2034);const w={tabList:"tabList_I6mw",tabItem:"tabItem_Qvbi"};var j=n(7458);function b(e){let{className:s,block:n,selectedValue:t,selectValue:o,tabValues:a}=e;const l=[],{blockElementScrollPositionUntilNextRender:d}=(0,r.o5)(),c=e=>{const s=e.currentTarget,n=l.indexOf(s),i=a[n].value;i!==t&&(d(s),o(i))},h=e=>{let s=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=l.indexOf(e.currentTarget)+1;s=l[n]??l[0];break}case"ArrowLeft":{const n=l.indexOf(e.currentTarget)-1;s=l[n]??l[l.length-1];break}}s?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":n},s),children:a.map((e=>{let{value:s,label:n,attributes:r}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:t===s?0:-1,"aria-selected":t===s,ref:e=>l.push(e),onKeyDown:h,onClick:c,...r,className:(0,i.Z)("tabs__item",w.tabItem,r?.className,{"tabs__item--active":t===s}),children:n??s},s)}))})}function g(e){let{lazy:s,children:n,selectedValue:i}=e;const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(s){const e=r.find((e=>e.props.value===i));return e?(0,t.cloneElement)(e,{className:"margin-top--md"}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:r.map(((e,s)=>(0,t.cloneElement)(e,{key:s,hidden:e.props.value!==i})))})}function S(e){const s=f(e);return(0,j.jsxs)("div",{className:(0,i.Z)("tabs-container",w.tabList),children:[(0,j.jsx)(b,{...e,...s}),(0,j.jsx)(g,{...e,...s})]})}function y(e){const s=(0,m.Z)();return(0,j.jsx)(S,{...e,children:h(e.children)},String(s))}},6436:(e,s,n)=>{n.d(s,{Z:()=>a,a:()=>o});var t=n(2983);const i={},r=t.createContext(i);function o(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);